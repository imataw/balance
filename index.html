<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸºé‡‘è¡¥ä»“è®¡ç®—å™¨</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            padding: 20px;
        }
        .calculator-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: 0 auto;
        }
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .calculator-container {
                padding: 15px;
                margin: 0;
            }
            .formula-box {
                font-size: 0.85em;
            }
            .result-box p {
                flex-direction: column;
                align-items: center;
                text-align: center;
                gap: 8px;
                padding: 15px 10px;
                background-color: #f8f9fa;
                border-radius: 8px;
                margin-bottom: 12px;
            }
            .result-box p:last-child {
                margin-bottom: 0;
            }
            .result-box strong {
                font-size: 1.3em;
                display: block;
                width: 100%;
                text-align: center;
            }
            .result-box span {
                color: #666;
                font-size: 0.9em;
                display: block;
                width: 100%;
                text-align: center;
            }
            h2 {
                font-size: 1.5rem;
            }
            .btn {
                width: 100%;
                margin-bottom: 5px;
            }
            .result-section {
                margin-bottom: 20px;
            }
            .result-section h5 {
                margin-bottom: 15px;
                text-align: center;
            }
            .result-box {
                padding: 15px 10px;
            }
        }
        .result-box {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .result-box h5 {
            color: #0d6efd;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e9ecef;
        }
        .result-box p {
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border-radius: 6px;
        }
        .result-box p:hover {
            background-color: #e9ecef;
        }
        .result-box strong {
            color: #198754;
            font-size: 1.1em;
        }
        .negative-value {
            color: #dc3545 !important;
        }
        .result-section {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .result-section:last-child {
            margin-bottom: 0;
        }
    </style>
</head>
<body>
    <div class="container p-0">
        <div class="calculator-container">
            <h2 class="text-center mb-4">åŸºé‡‘è¡¥ä»“è®¡ç®—å™¨</h2>
            
            <div class="formula-box">
                <h5>ğŸ“Š è®¡ç®—åŸç†è¯´æ˜</h5>
                <p>è¡¥ä»“è®¡ç®—åŸºäºä»¥ä¸‹åŸç†ï¼š</p>
                <ol>
                    <li>å½“å‰æ€»æŠ•å…¥ = å½“å‰æŒä»“ä»½é¢ Ã— æŒä»“å‡ä»·</li>
                    <li>å½“å‰å¸‚å€¼ = å½“å‰æŒä»“ä»½é¢ Ã— å½“å‰å‡€å€¼</li>
                    <li>äºæŸé‡‘é¢ = å½“å‰å¸‚å€¼ - å½“å‰æ€»æŠ•å…¥</li>
                    <li>è¡¥ä»“è®¡ç®—ï¼šå‡è®¾è¡¥ä»“Xä»½ï¼Œåˆ™æœ‰ï¼š<br>
                        (å½“å‰æŒä»“ä»½é¢ Ã— æŒä»“å‡ä»· + X Ã— å½“å‰å‡€å€¼) Ã· (å½“å‰æŒä»“ä»½é¢ + X) = ç›®æ ‡å‡ä»·</li>
                    <li>è§£æ–¹ç¨‹å¾—åˆ°éœ€è¦è¡¥ä»“çš„ä»½é¢X</li>
                </ol>
                <p>æ³¨æ„äº‹é¡¹ï¼š</p>
                <ul>
                    <li>ç›®æ ‡å‡ä»·é€šå¸¸è®¾ç½®ä¸ºæŒä»“å‡ä»·ï¼ˆå³å›æœ¬ç›®æ ‡ï¼‰æˆ–ä½äºæŒä»“å‡ä»·ï¼ˆéƒ¨åˆ†å›æœ¬ï¼‰</li>
                    <li>è¡¥ä»“æ—¶å½“å‰å‡€å€¼åº”ä½äºæŒä»“å‡ä»·ï¼Œå¦åˆ™è¡¥ä»“ä¼šå¢åŠ æˆæœ¬</li>
                    <li>è®¡ç®—ç»“æœä»…ä¾›å‚è€ƒï¼Œå®é™…æŠ•èµ„è¯·ç»“åˆå¸‚åœºæƒ…å†µå’Œä¸ªäººåˆ¤æ–­</li>
                </ul>
            </div>
            
            <form id="calculatorForm">
                <div class="d-flex justify-content-end mb-3">
                    <button type="button" class="btn btn-outline-info btn-sm" id="fillExample">
                        ğŸ“ å¡«å……ç¤ºä¾‹æ•°æ®
                    </button>
                </div>
                <div class="mb-3">
                    <label for="currentPrice" class="form-label">å½“å‰å‡€å€¼</label>
                    <input type="number" class="form-control" id="currentPrice" step="0.0001" required>
                </div>
                <div class="mb-3">
                    <label for="averagePrice" class="form-label">æŒä»“å‡ä»·</label>
                    <input type="number" class="form-control" id="averagePrice" step="0.0001" required>
                </div>
                <div class="mb-3">
                    <label for="currentShares" class="form-label">å½“å‰æŒä»“ä»½é¢</label>
                    <input type="number" class="form-control" id="currentShares" step="0.01" required>
                </div>
                <div class="mb-3">
                    <label for="planInvestment" class="form-label">è®¡åˆ’è¡¥ä»“é‡‘é¢</label>
                    <input type="number" class="form-control" id="planInvestment" step="0.01" required>
                </div>
                <div class="mb-3">
                    <label for="expectedReturn" class="form-label">é¢„æœŸæ¶¨å¹…(%)</label>
                    <input type="number" class="form-control" id="expectedReturn" step="0.01" required>
                </div>
                <button type="submit" class="btn btn-primary w-100">è®¡ç®—è¡¥ä»“æ–¹æ¡ˆ</button>
            </form>
            
            <div class="result-box mt-4" id="result" style="display: none;">
                <h4 class="mb-3">è¡¥ä»“å»ºè®®</h4>
                <div id="resultContent"></div>
            </div>
        </div>
    </div>

    <script>
        // æ·»åŠ ç¤ºä¾‹æ•°æ®å¡«å……åŠŸèƒ½
        document.getElementById('fillExample').addEventListener('click', function() {
            document.getElementById('currentPrice').value = '0.8500';
            document.getElementById('averagePrice').value = '1.0000';
            document.getElementById('currentShares').value = '10000';
            document.getElementById('planInvestment').value = '5000';
            document.getElementById('expectedReturn').value = '20';
            
            // è§¦å‘è®¡ç®—
            document.getElementById('calculatorForm').dispatchEvent(new Event('submit'));
        });

        document.getElementById('calculatorForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // è·å–è¾“å…¥å€¼
            const currentPrice = parseFloat(document.getElementById('currentPrice').value);
            const averagePrice = parseFloat(document.getElementById('averagePrice').value);
            const currentShares = parseFloat(document.getElementById('currentShares').value);
            const planInvestment = parseFloat(document.getElementById('planInvestment').value);
            const expectedReturn = parseFloat(document.getElementById('expectedReturn').value) / 100;
            
            // è®¡ç®—å½“å‰çŠ¶æ€
            const currentTotalInvestment = currentShares * averagePrice;
            const currentMarketValue = currentShares * currentPrice;
            const currentLoss = currentMarketValue - currentTotalInvestment;
            const currentReturnRate = (currentMarketValue / currentTotalInvestment - 1) * 100;
            
            // è®¡ç®—è¡¥ä»“æ•°æ®
            const sharesToBuy = planInvestment / currentPrice;
            const totalShares = currentShares + sharesToBuy;
            const newAveragePrice = (currentTotalInvestment + planInvestment) / totalShares;
            
            // è®¡ç®—æ¶¨å¹…éœ€æ±‚
            const currentRequiredReturn = ((averagePrice - currentPrice) / currentPrice) * 100;
            const newRequiredReturn = ((newAveragePrice - currentPrice) / currentPrice) * 100;
            
            // é¢„æœŸä»·æ ¼å’Œæ”¶ç›Š
            const expectedPrice = currentPrice * (1 + expectedReturn);
            const expectedValue = totalShares * expectedPrice;
            const expectedProfit = expectedValue - (currentTotalInvestment + planInvestment);
            
            // æ˜¾ç¤ºç»“æœ
            const resultDiv = document.getElementById('result');
            const resultContent = document.getElementById('resultContent');
            
            // æ ¼å¼åŒ–æ•°å­—æ˜¾ç¤º
            const formatNumber = (num) => {
                return new Intl.NumberFormat('zh-CN', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).format(num);
            };
            
            const formatPercent = (num) => {
                // ç›´æ¥æ ¼å¼åŒ–æ•°å­—ï¼Œä¸é™¤ä»¥100
                const formattedNum = num.toLocaleString('zh-CN', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2,
                    minimumIntegerDigits: 1
                });
                return formattedNum + '%';
            };
            
            resultContent.innerHTML = `
                <div class="result-section">
                    <h5>ğŸ“Š å½“å‰çŠ¶å†µ</h5>
                    <p class="d-flex flex-wrap justify-content-between align-items-center">
                        <span>å½“å‰æ€»æŠ•å…¥</span>
                        <strong>ï¿¥${formatNumber(currentTotalInvestment)}</strong>
                    </p>
                    <p class="d-flex flex-wrap justify-content-between align-items-center">
                        <span>å½“å‰å¸‚å€¼</span>
                        <strong>ï¿¥${formatNumber(currentMarketValue)}</strong>
                    </p>
                    <p class="d-flex flex-wrap justify-content-between align-items-center">
                        <span>å½“å‰äºæŸ</span>
                        <strong class="negative-value">ï¿¥${formatNumber(-currentLoss)}</strong>
                    </p>
                    <p class="d-flex flex-wrap justify-content-between align-items-center">
                        <span>å½“å‰æ”¶ç›Šç‡</span>
                        <strong class="${currentReturnRate >= 0 ? '' : 'negative-value'}">${formatPercent(currentReturnRate)}</strong>
                    </p>
                    <p class="d-flex flex-wrap justify-content-between align-items-center">
                        <span>å›æœ¬éœ€æ¶¨å¹…</span>
                        <strong>${formatPercent(currentRequiredReturn)}</strong>
                    </p>
                </div>
                
                <div class="result-section">
                    <h5>ğŸ’° è¡¥ä»“æ–¹æ¡ˆ</h5>
                    <p class="d-flex flex-wrap justify-content-between align-items-center">
                        <span>è¡¥ä»“ä»½é¢</span>
                        <strong>${formatNumber(sharesToBuy)} ä»½</strong>
                    </p>
                    <p class="d-flex flex-wrap justify-content-between align-items-center">
                        <span>è¡¥ä»“é‡‘é¢</span>
                        <strong>ï¿¥${formatNumber(planInvestment)}</strong>
                    </p>
                    <p class="d-flex flex-wrap justify-content-between align-items-center">
                        <span>è¡¥ä»“åæ€»ä»½é¢</span>
                        <strong>${formatNumber(totalShares)} ä»½</strong>
                    </p>
                    <p class="d-flex flex-wrap justify-content-between align-items-center">
                        <span>è¡¥ä»“åæ–°å‡ä»·</span>
                        <strong>ï¿¥${formatNumber(newAveragePrice)}</strong>
                    </p>
                    <p class="d-flex flex-wrap justify-content-between align-items-center">
                        <span>è¡¥ä»“åå›æœ¬æ‰€éœ€æ¶¨å¹…</span>
                        <strong>${formatPercent(newRequiredReturn)}</strong>
                    </p>
                </div>
                
                <div class="result-section">
                    <h5>ğŸ“ˆ é¢„æœŸæ”¶ç›Šï¼ˆ${formatPercent(expectedReturn * 100)}æ¶¨å¹…ï¼‰</h5>
                    <p class="d-flex flex-wrap justify-content-between align-items-center">
                        <span>é¢„æœŸå‡€å€¼</span>
                        <strong>ï¿¥${formatNumber(expectedPrice)}</strong>
                    </p>
                    <p class="d-flex flex-wrap justify-content-between align-items-center">
                        <span>é¢„æœŸå¸‚å€¼</span>
                        <strong>ï¿¥${formatNumber(expectedValue)}</strong>
                    </p>
                    <p class="d-flex flex-wrap justify-content-between align-items-center">
                        <span>é¢„æœŸç›ˆåˆ©</span>
                        <strong class="${expectedProfit >= 0 ? '' : 'negative-value'}">ï¿¥${formatNumber(expectedProfit)}</strong>
                    </p>
                </div>
            `;
            resultDiv.style.display = 'block';
        });
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
